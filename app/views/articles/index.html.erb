<%= content_for :page_meta do %>
  <% title_with_timeframe(
       page_title: "#{community_qualified_name} ðŸ‘©â€ðŸ’»ðŸ‘¨â€ðŸ’»",
       timeframe: params[:timeframe],
       content_for: true,
     ) %>

  <link rel="canonical" href="<%= app_url(request.path) %>" />
  <meta name="description" content="<%= SiteConfig.community_description %>">
  <%= meta_keywords_default %>

  <meta property="og:type" content="website" />
  <meta property="og:url" content="<%= app_url(request.path) %>" />
  <meta property="og:title" content="<%= title_with_timeframe(page_title: community_qualified_name, timeframe: params[:timeframe]) %>" />
  <meta property="og:image" content="<%= SiteConfig.main_social_image %>">
  <meta property="og:description" content="<%= SiteConfig.community_description %>" />
  <meta property="og:site_name" content="<%= community_qualified_name %>" />

  <meta name="twitter:site" content="@<%= SiteConfig.social_media_handles["twitter"] %>">
  <meta name="twitter:title" content="<%= title_with_timeframe(page_title: community_qualified_name, timeframe: params[:timeframe]) %>">
  <meta name="twitter:description" content="<%= SiteConfig.community_description %>">
  <meta name="twitter:image:src" content="<%= SiteConfig.main_social_image %>">
  <meta name="twitter:card" content="summary_large_image">
  <%= auto_discovery_link_tag(:rss, app_url("feed"), title: "#{community_name} RSS Feed") %>
<% end %>

<%= javascript_packs_with_chunks_tag "homePage", defer: true %>
<% if flash[:error].present? %>
  <p class="alert alert-danger" style="text-align: center"><%= flash[:error].capitalize %></p>
<% end %>
<div id="hero-html-wrapper" class="codeland-banner-container">
  <section class="crayons-layout">
    <div class="codeland-banner banner-pd-90 h-auto">
      <p class="banner-logo-text"><svg class="logo-icon" width="50" height="50" viewBox="0 0 55 55" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M27.5 55C42.6878 55 55 42.6878 55 27.5C55 12.3122 42.6878 0 27.5 0C12.3122 0 0 12.3122 0 27.5C0 42.6878 12.3122 55 27.5 55Z" fill="#181818"/>
        <path fill-rule="evenodd" clip-rule="evenodd" d="M30.3558 7.82756C29.9187 7.95886 24.6059 9.54465 18.5495 11.3516C12.4932 13.1584 7.46414 14.6732 7.37383 14.7176C6.84986 14.9754 6.5059 15.7676 6.68426 16.3059C6.74409 16.4863 7.36278 17.1929 11.7171 22.0532L16.6818 27.5947L16.4719 27.6607C16.3564 27.697 15.3459 28.0015 14.2263 28.3374C13.0087 28.7028 12.1276 28.989 12.0335 29.0498C11.8232 29.1858 11.563 29.5069 11.4616 29.7554C11.3374 30.06 11.3454 30.4614 11.4807 30.7142C11.6387 31.0093 28.786 50.1057 28.9685 50.1897C29.2038 50.2981 29.5674 50.2764 29.8151 50.1392C30.0648 50.0009 30.3501 49.6898 30.4445 49.4527C30.4816 49.3596 30.9552 47.4351 31.497 45.1761C32.0388 42.9171 32.6863 40.2225 32.936 39.1881C33.1857 38.1538 33.4885 36.8944 33.609 36.3897L33.8281 35.472L35.6494 37.5039C36.8403 38.8325 37.5252 39.5655 37.6283 39.6214C37.8684 39.7517 38.2321 39.7386 38.4995 39.59C38.745 39.4536 39.004 39.1798 39.1109 38.9437C39.2314 38.6773 45.516 12.4317 45.516 12.1944C45.516 11.9765 45.4383 11.7237 45.3304 11.5907C45.242 11.4817 45.0217 11.3592 44.8494 11.3231C44.6786 11.2874 45.4038 11.0785 37.1832 13.5312C33.4844 14.6347 30.4549 15.533 30.4511 15.5274C30.4472 15.5218 30.8162 13.9705 31.2713 12.0801C31.7679 10.0173 32.0987 8.56514 32.0988 8.44837C32.0992 7.9609 31.753 7.57944 31.3167 7.58627C31.2254 7.58774 30.793 7.6963 30.3558 7.82756ZM26.9731 13.3447C26.9633 13.3745 26.7753 14.1574 26.5553 15.0849C26.3353 16.0123 26.1452 16.7846 26.1328 16.8012C26.1095 16.8325 25.9245 16.8892 22.7564 17.8358C21.6216 18.1749 20.8135 18.4383 20.7185 18.5001C20.5079 18.6371 20.248 18.9581 20.1468 19.2062C20.0398 19.4683 20.0341 19.9057 20.1348 20.1217C20.1736 20.2049 21.2015 21.386 22.419 22.7464C23.8844 24.3837 24.6137 25.2272 24.5766 25.2423C24.5458 25.2547 24.4158 25.2932 24.2879 25.3279C24.1599 25.3625 23.5406 25.5476 22.9115 25.7393L21.7677 26.0878L17.8048 21.669C15.6251 19.2387 13.8509 17.2397 13.862 17.2268C13.8791 17.2069 26.8626 13.3092 26.9577 13.2955C26.9759 13.2928 26.9829 13.315 26.9731 13.3447ZM40.3976 17.0629C40.3971 17.074 39.0866 22.5485 37.6806 28.4123L36.89 31.7095L36.038 30.7593L35.1859 29.8092L36.0084 26.3762C36.5557 24.092 36.8307 22.8727 36.8301 22.7322C36.8279 22.1964 36.3975 21.7794 35.9427 21.8725C35.8661 21.8882 34.435 22.3094 32.7625 22.8084L29.7215 23.7158L28.4876 22.3403C27.7877 21.5602 27.2747 20.9562 27.3023 20.9448C27.4233 20.8948 40.27 17.0608 40.3302 17.0567C40.3675 17.0541 40.3978 17.0569 40.3976 17.0629ZM29.2448 30.3615L30.6729 31.9544L29.7938 35.6253C29.3104 37.6443 28.7554 39.9616 28.5608 40.7749C28.366 41.5882 28.2024 42.2497 28.1972 42.2449C28.192 42.2401 26.0234 39.8237 23.3781 36.8751C20.6875 33.8759 18.5901 31.5052 18.6172 31.494C18.754 31.4375 27.6726 28.7774 27.7389 28.7733C27.7923 28.7701 28.2639 29.2676 29.2448 30.3615Z" fill="url(#paint0_angular)"/>
        <defs>
          <radialGradient id="paint0_angular" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(27.7017 28.9512) rotate(164.399) scale(26.5144 30.8692)">
            <stop offset="0.00297156" stop-color="#A960EE"/>
            <stop offset="0.192708" stop-color="#FF333D"/>
            <stop offset="0.40625" stop-color="#62D2FD"/>
            <stop offset="0.604167" stop-color="#FF7D57"/>
            <stop offset="0.786458" stop-color="#FFCB57"/>
            <stop offset="0.973958" stop-color="#00B0E3"/>
          </radialGradient>
        </defs>
      </svg>
        UNITEDBITS</p>
      <div class="codeland-banner__description" style="margin-top: 20px">
        <p class="banner-heading">
          Share music royalties with fans rather than record labels
        </p>
        <p class="banner-description">
          UnitedBits turns music into investment product, to help artists bring new music to market, and fans earn income. Join the network, be a Music Pioneer.
        </p>
        <a href="http://unitedbits.io/phaethonp/the-network-for-music-pioneers-1c7o" class="crayons-btn login-card-btn login-btn-updated" aria-label="Create new account" data-no-instant>
          Learn more
        </a>
        <!--          <a href="/top/infinity" class="crayons-btn w-100 s:w-max">View our hottest content</a>-->
      </div>
    </div>
  </section>
</div>
<% cache(release_adjusted_cache_key("main-stories-index-#{params}-#{user_signed_in?}"), expires_in: 90.seconds) do %>
  <div class="crayons-layout crayons-layout--3-cols crayons-layout--3-cols--drop-right-left" id="index-container"
      data-params="<%= params.merge(sort_by: "hotness_score", sort_direction: "desc").to_json(only: %i[tag username q sort_by sort_direction]) %>" data-which="<%= @list_of %>"
      data-tag=""
      data-feed="<%= params[:timeframe] || "base-feed" %>"
      data-articles-since="<%= Timeframer.new(params[:timeframe]).datetime&.iso8601 %>">

    <%= render "articles/sidebar" %>

    <%# BEGIN Feed menu bar %>
    <main class="articles-list crayons-layout__content" id="articles-list" role="main">
      <h1 class="visually-hidden-header">Articles</h1>
      <%= render(partial: "onboardings/task_card") if user_signed_in? %>

      <header class="flex items-center p-2 m:p-0 m:pb-2" id="on-page-nav-controls">
        <button type="button" class="crayons-btn crayons-btn--ghost crayons-btn--icon mr-2 inline-block m:hidden" id="on-page-nav-butt-left" aria-label="nav-button-left">
          <div class="crayons-icon nav-icon ">
            <%= SiteConfig.left_navbar_svg_icon.html_safe %>
          </div>
        </button>
        <div class="flex-1 flex items-center justify-between">
          <h2 class="crayons-subtitle-2">Posts</h2>
          <nav class="crayons-tabs hidden s:flex">
            <a href="<%= list_path %>/feed_articles" class="crayons-tabs__item <%= "crayons-tabs__item--current" if %w[week month year infinity latest].exclude?(params[:timeframe]) %>">Feed</a>

            <a href="<%= list_path %>/top/week" class="crayons-tabs__item <%= "crayons-tabs__item--current" if timeframe_check("week") %>">Week</a>
            <a href="<%= list_path %>/top/month" class="crayons-tabs__item <%= "crayons-tabs__item--current" if timeframe_check("month") %>">Month</a>
            <a href="<%= list_path %>/top/year" class="crayons-tabs__item <%= "crayons-tabs__item--current" if timeframe_check("year") %>">Year</a>
            <a href="<%= list_path %>/top/infinity" class="crayons-tabs__item <%= "crayons-tabs__item--current" if timeframe_check("infinity") %>">Infinity</a>

            <a href="<%= list_path %>/latest" class="crayons-tabs__item <%= "crayons-tabs__item--current" if timeframe_check("latest") %>">Latest</a>
          </nav>

          <select class="crayons-select s:hidden ml-2 s:ml-auto w-auto" id="feed-filter-select" aria-label="feed-filter-select">
            <option value="<%= list_path %>/feed_articles" <% if ["week", "month", "year", "infinity", "latest"].exclude?(params[:timeframe]) %> selected<% end %>>Feed</option>
            <option value="<%= list_path %>/top/week" <% if timeframe_check("week") %> selected<% end %>>Week</option>
            <option value="<%= list_path %>/top/month" <% if timeframe_check("month") %> selected<% end %>>Month</option>
            <option value="<%= list_path %>/top/year" <% if timeframe_check("year") %> selected<% end %>>Year</option>
            <option value="<%= list_path %>/top/infinity" <% if timeframe_check("infinity") %> selected<% end %>>Infinity</option>
            <option value="<%= list_path %>/latest" <% if timeframe_check("latest") %> selected<% end %>>Latest</option>
          </select>
        </div>

        <button type="button" class="crayons-btn crayons-btn--ghost crayons-btn--icon ml-2 inline-block l:hidden" id="on-page-nav-butt-right" aria-label="nav-button-right">
          <div class="crayons-icon nav-icon ">
            <%= SiteConfig.right_navbar_svg_icon.html_safe %>
          </div>
        </button>
      </header>

      <% if user_signed_in? %>
        <div id="homepage-feed" style="min-height: 90vh"></div>
      <% else %>
        <%= render "stories/main_stories_feed" %>
      <% end %>

      <div id="followed-podcasts" data-episodes="<%= @podcast_episodes.to_json(include: { podcast: { only: %i[slug title id], methods: %i[image_90] } }) %>"></div>
      <div class="loading-articles" id="loading-articles">
        loading...
      </div>
    </main>

    <%= render "articles/sidebar_additional" %>
  </div>

  <%= render "stories/stories_list_script" %>
<% end %>
