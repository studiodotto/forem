<%= content_for :page_meta do %>
  <% title_with_timeframe(
       page_title: "#{community_qualified_name} ðŸ‘©â€ðŸ’»ðŸ‘¨â€ðŸ’»",
       timeframe: params[:timeframe],
       content_for: true,
       ) %>
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300&display=swap" rel="stylesheet">
  <!-- Font Awesome Icon Library -->
  <link rel="canonical" href="<%= app_url(request.path) %>" />
  <meta name="description" content="<%= SiteConfig.community_description %>">
<% end %>
<%#= javascript_packs_with_chunks_tag "homePage", defer: true %>
<% if flash[:error].present? %>
  <p class="alert alert-danger" style="text-align: center"><%= flash[:error].capitalize %></p>
<% end %>

<!-- User Modal -->
<!-- The Modal -->
<div id="myModal" class="user-modal">

  <!-- Modal content -->
  <div class="user-modal-content">
<!--    <div class="user-modal-header">-->
<!--      <span class="user-close">&times;</span>-->
<!--      Add your information-->
<!--    </div>-->
    <header class="Header" role="banner">
      <div>
        <span>
        </span>
        <span class="Header-navClose" aria-label="Close">

        </span>
      </div>
      <div class="Header-logo">
        <div class="Header-logoWrap">
          <div class="Header-logoBevel">
          </div>
          <div class="Header-logoBorder">
          </div>
          <div class="Header-logoImage" alt="Logo">
          </div>
        </div>
      </div>
      <h2 class="Header-purchaseDescription u-textTruncate">
        Add your information
      </h2>
      <div class="Header-account" style="position: relative;">
      </div>
    </header>
    <div class="user-modal-body">
      <p class="product-info" id="product-name"></p>
      <p class="product-info" id="product-price"></p>
      <hr style="margin-bottom: 18px">
      <%= form_tag orders_path, id: "credit-card-form", method: :post do %>
        <div class="crayons-field mb-3">
<!--          <label class="crayons-field__label" for="user_email">First Name</label>-->
          <input autocomplete="first_name" class="crayons-textfield" type="text" name="first_name" placeholder="First name" value="<%= current_user.present? ? current_user.first_name : '' %>" id="first_name" required>
          <p style="display: none" id="first_name_error" class="error-text">First name can't be blank</p>
        </div>
        <div class="crayons-field mb-3">
<!--          <label class="crayons-field__label" for="user_email">Last Name</label>-->
          <input autocomplete="last_name" class="crayons-textfield" type="text" name="last_name" placeholder="Last name" value="<%= current_user.present? ? current_user.last_name : '' %>" id="last_name" required>
          <p style="display: none" id="last_name_error" class="error-text">Last name can't be blank</p>
        </div>
        <div class="crayons-field mb-3">
<!--          <label class="crayons-field__label" for="user_email">Email</label>-->
          <input autocomplete="email" class="crayons-textfield" type="email" name="email" placeholder="Email" id="email" value="<%= current_user.present? ? current_user.email : '' %>" required <%= current_user.present? ? 'readonly' : '' %>>
          <p style="display: none" class="error-text" id="email_error">Email is invalid</p>
        </div>
        <div class="crayons-field mb-3">
          <!--          <label class="crayons-field__label" for="user_email">Email</label>-->
          <input autocomplete="password" class="crayons-textfield" type="password" name="password" placeholder="Password" id="password" value="<%= current_user.present? ? '12312312213' : '' %>" required <%= current_user.present? ? 'readonly' : '' %>>
          <p style="display: none" class="error-text" id="password_error">Password is invalid</p>
        </div>
        <% if current_user.present? %>
          <p style="color: #3098de; font-size: 13px;">you're already registered you can only update first and last name</p>
        <% end %>
        <input type="hidden" name="music_release_id" id="music_release_id">
        <input type="hidden" name="project_price" id="project_price">
        <input type="hidden" name="stripe_token" id="stripe_card_token">
        <button class="crayons-btn crayons-btn--secondary continue-btn-payment" id="continue">Continue</button>
      <% end %>
    </div>
<!--    <div class="user-modal-footer">-->
<!--      <button class="crayons-btn crayons-btn--secondary" id="continue">Continue</button>-->
<!--    </div>-->
  </div>

</div>


<div id="myCardModal" class="user-modal">

  <!-- Modal content -->
  <div class="user-modal-content">
    <!--    <div class="user-modal-header">-->
    <!--      <span class="user-close">&times;</span>-->
    <!--      Add your information-->
    <!--    </div>-->
    <header class="Header" role="banner">
      <div>
        <span>
        </span>
        <span class="Header-navClose" aria-label="Close">

        </span>
      </div>
      <div class="Header-logo">
        <div class="Header-logoWrap">
          <div class="Header-logoBevel">
          </div>
          <div class="Header-logoBorder">
          </div>
          <div class="Header-logoImage" alt="Logo">
          </div>
        </div>
      </div>
      <h2 class="Header-purchaseDescription u-textTruncate">
        Card Information
      </h2>
      <div class="Header-account" style="position: relative;">
      </div>
    </header>
    <div class="user-modal-body">
      <div class="billing-item">
        <% if @source.present? %>
          <p class="product-info"><%= @source.brand %> ending in <%= @source.last4 %></p>
          <p class="product-info">Expires <%= @source.exp_month %> / <%= @source.exp_year %></p>
        <% end %>
      </div>
      <hr>
      <p style="color: #3098de; font-size: 13px;text-align: center">Card is already added</p>
    </div>

    <div class="user-modal-footer">
      <button class="crayons-btn crayons-btn--secondary continue-btn-payment" id="continue-payment-btn">Continue</button>
    </div>
  </div>

</div>


<div id="confirmationModal" class="user-modal">

  <!-- Modal content -->
  <div class="user-modal-content">
    <!--    <div class="user-modal-header">-->
    <!--      <span class="user-close">&times;</span>-->
    <!--      Add your information-->
    <!--    </div>-->
    <header class="Header" role="banner">
      <div>
        <span>
        </span>
        <span class="Header-navClose" aria-label="Close">

        </span>
      </div>
      <div class="Header-logo">
        <div class="Header-logoWrap">
          <div class="Header-logoBevel">
          </div>
          <div class="Header-logoBorder">
          </div>
          <div class="Header-logoImage" alt="Logo">
          </div>
        </div>
      </div>
      <h2 class="Header-purchaseDescription u-textTruncate">
        Review Information
      </h2>
      <div class="Header-account" style="position: relative;">
      </div>
    </header>
    <div class="user-modal-body">
      <div class="billing-item">
        <p class="product-info" id='confirmName'></p>
        <p class="product-info" id='confirmLastName'></p>
        <p class="product-info" id='confirmEmail'></p>
        <hr>
        <p class="product-info" id='confirmProduct'></p>
        <p class="product-info" id='confirmPrice'></p>
      </div>
      <hr>
      <p style="color: #3098de; font-size: 13px;text-align: center">Review all information</p>
    </div>

    <div class="user-modal-footer">
      <button class="crayons-btn crayons-btn--secondary continue-btn-payment" id="confirmPaymentBtn">Confirm Order</button>
    </div>
  </div>

</div>

<!-- The Modal -->
<div id="paymentConfirmationModal" class="user-modal">

  <!-- Modal content -->
  <div class="user-modal-content">
    <!--    <div class="user-modal-header">-->
    <!--      <span class="user-close">&times;</span>-->
    <!--      Add your information-->
    <!--    </div>-->
    <header class="Header" role="banner">
      <div>
        <span>
        </span>
        <span class="Header-navClose" aria-label="Close">

        </span>
      </div>
      <div class="Header-logo">
        <div class="Header-logoWrap">
          <div class="Header-logoBevel">
          </div>
          <div class="Header-logoBorder">
          </div>
          <div class="Header-logoImage" alt="Logo">
          </div>
        </div>
      </div>
      <h2 class="Header-purchaseDescription u-textTruncate">
        Review Order Details
      </h2>
      <div class="Header-account" style="position: relative;">
      </div>
    </header>
    <div class="user-modal-body">
      <h1>Project</h1>
      <p>Test project</p>
      <h1>Price</h1>
      <p>12.00 $</p>
      <%#= form_tag stripe_active_cards_path, id: "credit-card-form", method: :post do %>
<!--        <div class="crayons-field mb-3">-->
<!--                    <label class="crayons-field__label" for="user_email">First Name</label>-->
<!--          <input autocomplete="first_name" class="crayons-textfield" type="text" name="first_name" placeholder="First name" id="first_name" required>-->
<!--          <p style="display: none" id="first_name_error" class="error-text">First name can't be blank</p>-->
<!--        </div>-->
<!--        <div class="crayons-field mb-3">-->
<!--                   <label class="crayons-field__label" for="user_email">Last Name</label>-->
<!--          <input autocomplete="last_name" class="crayons-textfield" type="text" name="last_name" placeholder="Last name" id="last_name" required>-->
<!--          <p style="display: none" id="last_name_error" class="error-text">Last name can't be blank</p>-->
<!--        </div>-->
<!--        <div class="crayons-field mb-3">-->
<!--                   <label class="crayons-field__label" for="user_email">Email</label>-->
<!--          <input autocomplete="email" class="crayons-textfield" type="email" name="email" placeholder="Email" id="email" required>-->
<!--          <p style="display: none" class="error-text" id="email_error">Email is invalid</p>-->
<!--        </div>-->
<!--        <input type="hidden" name="stripe_token" id="stripe_card_token">-->

<!--        <button class="crayons-btn crayons-btn--secondary" id="continue">Continue</button>-->
      <%# end %>
    </div>
    <!--    <div class="user-modal-footer">-->
    <!--      <button class="crayons-btn crayons-btn--secondary" id="continue">Continue</button>-->
    <!--    </div>-->
  </div>

</div>
<!-- New View Html -->
<div id="hero-html-wrapper" class="codeland-banner-container">
  <section class="crayons-layout">
    <div class="codeland-banner banner-pd-90 h-auto">
      <p class="banner-logo-text"><svg class="logo-icon" width="50" height="50" viewBox="0 0 55 55" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M27.5 55C42.6878 55 55 42.6878 55 27.5C55 12.3122 42.6878 0 27.5 0C12.3122 0 0 12.3122 0 27.5C0 42.6878 12.3122 55 27.5 55Z" fill="#181818"/>
        <path fill-rule="evenodd" clip-rule="evenodd" d="M30.3558 7.82756C29.9187 7.95886 24.6059 9.54465 18.5495 11.3516C12.4932 13.1584 7.46414 14.6732 7.37383 14.7176C6.84986 14.9754 6.5059 15.7676 6.68426 16.3059C6.74409 16.4863 7.36278 17.1929 11.7171 22.0532L16.6818 27.5947L16.4719 27.6607C16.3564 27.697 15.3459 28.0015 14.2263 28.3374C13.0087 28.7028 12.1276 28.989 12.0335 29.0498C11.8232 29.1858 11.563 29.5069 11.4616 29.7554C11.3374 30.06 11.3454 30.4614 11.4807 30.7142C11.6387 31.0093 28.786 50.1057 28.9685 50.1897C29.2038 50.2981 29.5674 50.2764 29.8151 50.1392C30.0648 50.0009 30.3501 49.6898 30.4445 49.4527C30.4816 49.3596 30.9552 47.4351 31.497 45.1761C32.0388 42.9171 32.6863 40.2225 32.936 39.1881C33.1857 38.1538 33.4885 36.8944 33.609 36.3897L33.8281 35.472L35.6494 37.5039C36.8403 38.8325 37.5252 39.5655 37.6283 39.6214C37.8684 39.7517 38.2321 39.7386 38.4995 39.59C38.745 39.4536 39.004 39.1798 39.1109 38.9437C39.2314 38.6773 45.516 12.4317 45.516 12.1944C45.516 11.9765 45.4383 11.7237 45.3304 11.5907C45.242 11.4817 45.0217 11.3592 44.8494 11.3231C44.6786 11.2874 45.4038 11.0785 37.1832 13.5312C33.4844 14.6347 30.4549 15.533 30.4511 15.5274C30.4472 15.5218 30.8162 13.9705 31.2713 12.0801C31.7679 10.0173 32.0987 8.56514 32.0988 8.44837C32.0992 7.9609 31.753 7.57944 31.3167 7.58627C31.2254 7.58774 30.793 7.6963 30.3558 7.82756ZM26.9731 13.3447C26.9633 13.3745 26.7753 14.1574 26.5553 15.0849C26.3353 16.0123 26.1452 16.7846 26.1328 16.8012C26.1095 16.8325 25.9245 16.8892 22.7564 17.8358C21.6216 18.1749 20.8135 18.4383 20.7185 18.5001C20.5079 18.6371 20.248 18.9581 20.1468 19.2062C20.0398 19.4683 20.0341 19.9057 20.1348 20.1217C20.1736 20.2049 21.2015 21.386 22.419 22.7464C23.8844 24.3837 24.6137 25.2272 24.5766 25.2423C24.5458 25.2547 24.4158 25.2932 24.2879 25.3279C24.1599 25.3625 23.5406 25.5476 22.9115 25.7393L21.7677 26.0878L17.8048 21.669C15.6251 19.2387 13.8509 17.2397 13.862 17.2268C13.8791 17.2069 26.8626 13.3092 26.9577 13.2955C26.9759 13.2928 26.9829 13.315 26.9731 13.3447ZM40.3976 17.0629C40.3971 17.074 39.0866 22.5485 37.6806 28.4123L36.89 31.7095L36.038 30.7593L35.1859 29.8092L36.0084 26.3762C36.5557 24.092 36.8307 22.8727 36.8301 22.7322C36.8279 22.1964 36.3975 21.7794 35.9427 21.8725C35.8661 21.8882 34.435 22.3094 32.7625 22.8084L29.7215 23.7158L28.4876 22.3403C27.7877 21.5602 27.2747 20.9562 27.3023 20.9448C27.4233 20.8948 40.27 17.0608 40.3302 17.0567C40.3675 17.0541 40.3978 17.0569 40.3976 17.0629ZM29.2448 30.3615L30.6729 31.9544L29.7938 35.6253C29.3104 37.6443 28.7554 39.9616 28.5608 40.7749C28.366 41.5882 28.2024 42.2497 28.1972 42.2449C28.192 42.2401 26.0234 39.8237 23.3781 36.8751C20.6875 33.8759 18.5901 31.5052 18.6172 31.494C18.754 31.4375 27.6726 28.7774 27.7389 28.7733C27.7923 28.7701 28.2639 29.2676 29.2448 30.3615Z" fill="url(#paint0_angular)"/>
        <defs>
          <radialGradient id="paint0_angular" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(27.7017 28.9512) rotate(164.399) scale(26.5144 30.8692)">
            <stop offset="0.00297156" stop-color="#A960EE"/>
            <stop offset="0.192708" stop-color="#FF333D"/>
            <stop offset="0.40625" stop-color="#62D2FD"/>
            <stop offset="0.604167" stop-color="#FF7D57"/>
            <stop offset="0.786458" stop-color="#FFCB57"/>
            <stop offset="0.973958" stop-color="#00B0E3"/>
          </radialGradient>
        </defs>
      </svg>
        RAW N UNCUT</p>
      <div class="codeland-banner__description" style="margin-top: 20px">
        <p class="banner-description" style="color: white !important;">
          Music streaming from the settings uncut N unedited. UnitedBits connects fans and
        </p>
        <p class="banner-description" style="color: white !important;margin-top: 5px !important;">
          artists to break new music and share it with the world.
        </p>
<!--        <p class="banner-description">-->
<!--          into a business, create a legacy of music for the future-->
<!--        </p>-->
<!--        <a href="<%#= sign_up_path(state: "new-user") %>" class="crayons-btn login-card-btn login-btn-updated" aria-label="Create new account" data-no-instant>-->
<!--          JOIN MUSIC PIONEERS-->
<!--        </a>-->
        <a href="http://unitedbits.io/phaethonp/the-network-for-music-pioneers-1c7o" class="crayons-btn login-card-btn login-btn-updated" aria-label="Create new account" data-no-instant>
          Learn more
        </a>
        <!--          <a href="/top/infinity" class="crayons-btn w-100 s:w-max">View our hottest content</a>-->
      </div>
    </div>
  </section>
</div>

<div class="crayons-layout crayons-layout--3-cols crayons-layout--3-cols--drop-right-left">
  <%= render "articles/sidebar" %>
  <main class="articles-list crayons-layout__content">
    <!-- Header -->
    <header class="flex items-center p-2 m:p-0 m:pb-2" id="on-page-nav-controls">
      <button type="button" class="crayons-btn crayons-btn--ghost crayons-btn--icon mr-2 inline-block m:hidden" id="on-page-nav-butt-left" aria-label="nav-button-left">
        <div class="crayons-icon nav-icon ">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" height="24" width="24"><path d="M398.044 29.719C359.712 10.555 309.267 0 256.001 0c-53.271 0-103.719 10.555-142.05 29.721-43.457 21.73-67.39 52.497-67.39 86.635v279.288c0 34.138 23.933 64.906 67.392 86.636C152.285 501.446 202.732 512 256.002 512c53.266 0 103.711-10.555 142.043-29.721 43.46-21.732 67.393-52.498 67.393-86.636V116.355c.001-34.138-23.934-64.904-67.394-86.636zM256.001 46.548c93.229 0 162.889 36.855 162.889 69.808 0 32.953-69.66 69.809-162.889 69.809-93.23 0-162.892-36.857-162.892-69.809 0-32.953 69.661-69.808 162.892-69.808zm162.89 349.095c0 32.953-69.662 69.809-162.891 69.809-93.23 0-162.892-36.856-162.892-69.809v-18.58c6.348 4.292 13.294 8.346 20.844 12.121 38.332 19.167 88.779 29.721 142.05 29.721 53.266 0 103.711-10.555 142.043-29.721 7.552-3.777 14.498-7.829 20.846-12.121v18.58zm.002-93.095h-.002c0 32.953-69.66 69.809-162.889 69.809-93.23 0-162.892-36.857-162.892-69.809v-18.58c6.348 4.292 13.294 8.343 20.844 12.119 38.332 19.168 88.779 29.722 142.05 29.722 53.266 0 103.711-10.555 142.043-29.722 7.552-3.777 14.498-7.829 20.846-12.123v18.584zm0-93.097h-.002c0 32.954-69.66 69.811-162.889 69.811-93.23 0-162.892-36.856-162.892-69.811v-18.579c6.348 4.292 13.294 8.343 20.844 12.118 38.331 19.167 88.779 29.721 142.05 29.721 53.266 0 103.711-10.555 142.043-29.721 7.552-3.777 14.498-7.829 20.846-12.121v18.582z"></path></svg>

        </div>
      </button>
      <div class="flex-1 flex items-center justify-between">
        <h2 class="crayons-subtitle-2">New Releases</h2>
        <nav class="crayons-tabs hidden s:flex">
          <a href="/latest" class="crayons-tabs__item">Posts</a>
          <a href="/projects_feed" class="crayons-tabs__item crayons-tabs__item--current">New releases</a>
        </nav>
        <select class="crayons-select s:hidden ml-2 s:ml-auto w-auto" id="feed-filter-select" aria-label="feed-filter-select">
          <option value="/latest">Posts</option>
          <option value="/projects_feed" selected>New releases</option>
        </select>
      </div>

      <button type="button" class="crayons-btn crayons-btn--ghost crayons-btn--icon ml-2 inline-block l:hidden" id="on-page-nav-butt-right" aria-label="nav-button-right">
        <div class="crayons-icon nav-icon ">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 216.934 216.934" height="24" width="24"><path d="M179.508 91.769a7.5 7.5 0 00-6.95-4.681h-32.323l26.743-77.131a7.5 7.5 0 00-12.373-7.777L39.089 116.98a7.499 7.499 0 005.288 12.82h32L47.26 206.781a7.499 7.499 0 0012.238 8.034L177.782 99.969a7.5 7.5 0 001.726-8.2zM73.196 180.61l21.051-55.657a7.5 7.5 0 00-7.015-10.153H62.563l79.623-79.13-19.575 56.462a7.5 7.5 0 007.085 9.957h24.37l-80.87 78.521z"></path></svg>
        </div>
      </button>
    </header>
    <!-- Center Content Div -->
    <div style="min-height: 90vh">
      <% @organizations.each do |project| %>
        <% if project.music_releases.first.present? %>
          <%= render partial: 'shared/project_card', locals: {project: project, music_release: project.music_releases.first, composer: project.composer_id.present? ? @composers[project.composer_id][0] : '', artist_side: false, project_side: false } %>
        <% end %>
      <% end %>
      <!-- Right sidebar -->
      <div class="sidebar-wrapper sidebar-wrapper-right crayons-layout__sidebar-right">
      </div>
    </div>
  </main>
</div>
<script src="https://checkout.stripe.com/checkout.js"></script>
<script type="text/javascript" charset="utf-8">
  // var span = document.getElementsByClassName("user-close")[0];
  var mainNavMoreTrigger = document.getElementById('main-nav-more-trigger');
  function toggleMainNavMore() {
    document.getElementById('main-nav-more').classList.remove('hidden');
    mainNavMoreTrigger.classList.add('hidden');
  }
  if (mainNavMoreTrigger) {
    mainNavMoreTrigger.addEventListener('click', toggleMainNavMore);
  }
  // When the user clicks the button, open the modal
  function openModal(){
    <% unless current_user.present? %>
      resetFields();
    <% end %>
    var modal = document.getElementById("myModal");
    modal.style.display = "block";
  }

  // function openConfirmationModal(){
  //   var modal = document.getElementById("paymentConfirmationModal");
  //   modal.style.display = "block";
  // }
  // When the user clicks on <span> (x), close the modal
  function closeModal(){
    var modal = document.getElementById("myModal");
    modal.style.display = "none";
  }

  function closeCardModal(){
    var modal = document.getElementById("myCardModal");
    modal.style.display = "none";
  }
  // span.onclick = function() {
  //   var modal = document.getElementById("myModal");
  //   resetFields();
  //   modal.style.display = "none";
  // }

  // When the user clicks anywhere outside of the modal, close it
  window.onclick = function(event) {
    var modal = document.getElementById("myModal");
    var cmodal = document.getElementById("confirmationModal");
    var ccmodal = document.getElementById("myCardModal");
    if (event.target == modal) {
      <% unless current_user.present? %>
        resetFields();
      <% end %>
      modal.style.display = "none";
    }
    if (event.target == ccmodal) {
      ccmodal.style.display = "none";
    }
  }
  function resetFields(){
    document.getElementById('first_name').value = '';
    document.getElementById('last_name').value = '';
    document.getElementById('email').value = '';
    document.getElementById('password').value = '';
    document.getElementById('first_name_error').style.display='none'
    document.getElementById('last_name_error').style.display='none'
    document.getElementById('email_error').style.display='none'
    document.getElementById('password_error').style.display='none'
  }
  function buy_product(music_release_id, price, name){
    document.getElementById('product-name').innerText=name;
    document.getElementById('product-price').innerHTML='$ '+ price.toFixed(2);
    document.getElementById('music_release_id').value=music_release_id;
    document.getElementById('project_price').value=price.toFixed(2);
    // $('#product-price').value=price;
    openModal();
    // handler.open({
    //   description: 'Add Credit Card',
    //   amount: 0,
      //email: "<%#= current_user.present? ? current_user.email : '' %>",
      // address: "asadadadasdadadddad",
      // street: false,
      // city: false,
      // panelLabel: "Add Card",
    // });
  }
  setTimeout(function () {
    var handler = StripeCheckout.configure({
      key: '<%= SiteConfig.stripe_publishable_key %>',
      image: "https://res.cloudinary.com/dyzicyjzq/image/fetch/s--rMcf2ecU--/c_fill,f_auto,fl_progressive,h_90,q_auto,w_90/https://studioappbucket.s3.amazonaws.com/uploads/user/profile_image/6/bad08ef2-a74c-4316-8084-a645c5052bef.png",
      locale: 'auto',
      token: function (token) {
        var token_input = document.getElementById("stripe_card_token")
        token_input.value = token.id
        document.getElementById('continue-payment-btn').click();
        // var form = document.getElementById('credit-card-form')
        // form.submit();
        // openConfirmationModal();
        // document.getElementById('add-credit-card-button').style.display = 'none'
        // document.getElementById('card-msg').style.display = 'block'

      }

    });
    <%# if current_user.try(:stripe_id_code).blank? %>
<!--    document.getElementById('buy-music-btn-<%#= project.id %>').addEventListener('click', function (e) {-->
      // Open Checkout with further options:

      // e.preventDefault();
    // });
    <%# end %>
    function openConfirmationModal(){
      var first_name = document.getElementById('first_name').value;
      var last_name = document.getElementById('last_name').value;
      var email = document.getElementById('email').value;
      document.getElementById('confirmName').innerHTML = first_name;
      document.getElementById('confirmLastName').innerHTML = last_name;
      document.getElementById('confirmEmail').innerHTML = email;
      document.getElementById('confirmProduct').innerHTML = document.getElementById('product-name').innerHTML
      document.getElementById('confirmPrice').innerHTML = document.getElementById('product-price').innerHTML
      var modal = document.getElementById("confirmationModal");
      modal.style.display = "block";
    }

    document.getElementById('confirmPaymentBtn').addEventListener('click', function (e){
      document.getElementById('confirmPaymentBtn').innerText = 'Please wait'
      document.getElementById('confirmPaymentBtn').disabled = true
      var form = document.getElementById('credit-card-form')
      form.submit();
    })

    document.getElementById('continue-payment-btn').addEventListener('click', function (e){
      closeCardModal();
      openConfirmationModal();
    })
    document.getElementById('continue').addEventListener('click', function (e){
      var first_name = document.getElementById('first_name').value;
      var last_name = document.getElementById('last_name').value;
      var email = document.getElementById('email').value;
      var password = document.getElementById('password').value;
      var error_count = 0;
      if (first_name.replace(/\s/g, '') == ''){
        document.getElementById('first_name_error').style.display='block'
        error_count = error_count + 1;
      }else{
        document.getElementById('first_name_error').style.display='none'
      }
      if (last_name.replace(/\s/g, '') == ''){
        document.getElementById('last_name_error').style.display='block'
        error_count = error_count + 1;
      }else{
        document.getElementById('last_name_error').style.display='none'
      }
      if (email.replace(/\s/g, '') == '' || !email.includes('@')){
        document.getElementById('email_error').style.display='block'
        error_count = error_count + 1;
      }else{
        document.getElementById('email_error').style.display='none'
      }
      if (password.replace(/\s/g, '') == '' || password.length < 8){
        document.getElementById('password_error').style.display='block'
        error_count = error_count + 1;
      }else{
        document.getElementById('password_error').style.display='none'
      }
      if(error_count == 0){
        closeModal();
        <% unless @source.present? %>
          handler.open({
            description: 'Add Credit Card',
            amount: 0,
            email: document.getElementById('email').value,
            panelLabel: "Add Card",
            // panelLabel: "Confirm purchase",
          });
        <% else %>
          var modal = document.getElementById("myCardModal");
          modal.style.display = "block";
        <% end %>
      }
      e.preventDefault();
    })
    // Close Checkout on page navigation:
    window.addEventListener('popstate', function () {
      handler.close();
    });
  }, 220)
</script>
