<%= content_for :page_meta do %>
  <% title_with_timeframe(
       page_title: "#{community_qualified_name} ðŸ‘©â€ðŸ’»ðŸ‘¨â€ðŸ’»",
       timeframe: params[:timeframe],
       content_for: true,
       ) %>
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
  <!-- Font Awesome Icon Library -->
  <link rel="canonical" href="<%= app_url(request.path) %>" />
  <meta name="description" content="<%= SiteConfig.community_description %>">
<% end %>
<%#= javascript_packs_with_chunks_tag "homePage", defer: true %>
<% if flash[:error].present? %>
  <p class="alert alert-danger" style="text-align: center"><%= flash[:error].capitalize %></p>
<% end %>
<style>
  .w-100{
    width: 100% !important;
  }.m-banner{
    display: none;
     }
  @media only screen and (max-width: 600px) {
    body {
      background: rgba(220, 220, 220, 0.5);
      /*transform: rotate(-180deg);*/
    }
    body.default-header{
      padding-top: 60px;
    }
    .m-banner{
      display: block;
    }
  }
</style>
<!-- User Modal -->
<!-- The Modal -->
<div id="myModal" class="user-modal">

  <!-- Modal content -->
  <div class="user-modal-content">
<!--    <div class="user-modal-header">-->
<!--      <span class="user-close">&times;</span>-->
<!--      Add your information-->
<!--    </div>-->
    <header class="Header" role="banner">
      <div>
        <span>
        </span>
        <span class="Header-navClose" aria-label="Close">

        </span>
      </div>
      <div class="Header-logo">
        <div class="Header-logoWrap">
          <div class="Header-logoBevel">
          </div>
          <div class="Header-logoBorder">
          </div>
          <div class="Header-logoImage" alt="Logo">
          </div>
        </div>
      </div>
      <h2 class="Header-purchaseDescription u-textTruncate">
        Add your information
      </h2>
      <div class="Header-account" style="position: relative;">
      </div>
    </header>
    <div class="user-modal-body">
      <p class="product-info" id="product-name"></p>
      <p class="product-info" id="product-price"></p>
      <hr style="margin-bottom: 18px">
      <%= form_tag orders_path, id: "credit-card-form", method: :post do %>
        <div class="crayons-field mb-3">
<!--          <label class="crayons-field__label" for="user_email">First Name</label>-->
          <input autocomplete="first_name" class="crayons-textfield" type="text" name="first_name" placeholder="First name" value="<%= current_user.present? ? current_user.first_name : '' %>" id="first_name" required>
          <p style="display: none" id="first_name_error" class="error-text">First name can't be blank</p>
        </div>
        <div class="crayons-field mb-3">
<!--          <label class="crayons-field__label" for="user_email">Last Name</label>-->
          <input autocomplete="last_name" class="crayons-textfield" type="text" name="last_name" placeholder="Last name" value="<%= current_user.present? ? current_user.last_name : '' %>" id="last_name" required>
          <p style="display: none" id="last_name_error" class="error-text">Last name can't be blank</p>
        </div>
        <div class="crayons-field mb-3">
<!--          <label class="crayons-field__label" for="user_email">Email</label>-->
          <input autocomplete="email" class="crayons-textfield" type="email" name="email" placeholder="Email" id="email" value="<%= current_user.present? ? current_user.email : '' %>" required <%= current_user.present? ? 'readonly' : '' %>>
          <p style="display: none" class="error-text" id="email_error">Email is invalid</p>
        </div>
        <div class="crayons-field mb-3">
          <!--          <label class="crayons-field__label" for="user_email">Email</label>-->
          <input autocomplete="password" class="crayons-textfield" type="password" name="password" placeholder="Password" id="password" value="<%= current_user.present? ? '12312312213' : '' %>" required <%= current_user.present? ? 'readonly' : '' %>>
          <p style="display: none" class="error-text" id="password_error">Password is invalid</p>
        </div>
        <% if current_user.present? %>
          <p style="color: #3098de; font-size: 13px;">you're already registered you can only update first and last name</p>
        <% end %>
        <input type="hidden" name="music_release_id" id="music_release_id">
        <input type="hidden" name="project_price" id="project_price">
        <input type="hidden" name="stripe_token" id="stripe_card_token">
        <button class="crayons-btn crayons-btn--secondary continue-btn-payment" id="continue">Continue</button>
      <% end %>
    </div>
<!--    <div class="user-modal-footer">-->
<!--      <button class="crayons-btn crayons-btn--secondary" id="continue">Continue</button>-->
<!--    </div>-->
  </div>

</div>


<div id="myCardModal" class="user-modal">

  <!-- Modal content -->
  <div class="user-modal-content">
    <!--    <div class="user-modal-header">-->
    <!--      <span class="user-close">&times;</span>-->
    <!--      Add your information-->
    <!--    </div>-->
    <header class="Header" role="banner">
      <div>
        <span>
        </span>
        <span class="Header-navClose" aria-label="Close">

        </span>
      </div>
      <div class="Header-logo">
        <div class="Header-logoWrap">
          <div class="Header-logoBevel">
          </div>
          <div class="Header-logoBorder">
          </div>
          <div class="Header-logoImage" alt="Logo">
          </div>
        </div>
      </div>
      <h2 class="Header-purchaseDescription u-textTruncate">
        Card Information
      </h2>
      <div class="Header-account" style="position: relative;">
      </div>
    </header>
    <div class="user-modal-body">
      <div class="billing-item">
        <% if @source.present? %>
          <p class="product-info"><%= @source.brand %> ending in <%= @source.last4 %></p>
          <p class="product-info">Expires <%= @source.exp_month %> / <%= @source.exp_year %></p>
        <% end %>
      </div>
      <hr>
      <p style="color: #3098de; font-size: 13px;text-align: center">Card is already added</p>
    </div>

    <div class="user-modal-footer">
      <button class="crayons-btn crayons-btn--secondary continue-btn-payment" id="continue-payment-btn">Continue</button>
    </div>
  </div>

</div>


<div id="confirmationModal" class="user-modal">

  <!-- Modal content -->
  <div class="user-modal-content">
    <!--    <div class="user-modal-header">-->
    <!--      <span class="user-close">&times;</span>-->
    <!--      Add your information-->
    <!--    </div>-->
    <header class="Header" role="banner">
      <div>
        <span>
        </span>
        <span class="Header-navClose" aria-label="Close">

        </span>
      </div>
      <div class="Header-logo">
        <div class="Header-logoWrap">
          <div class="Header-logoBevel">
          </div>
          <div class="Header-logoBorder">
          </div>
          <div class="Header-logoImage" alt="Logo">
          </div>
        </div>
      </div>
      <h2 class="Header-purchaseDescription u-textTruncate">
        Review Information
      </h2>
      <div class="Header-account" style="position: relative;">
      </div>
    </header>
    <div class="user-modal-body">
      <div class="billing-item">
        <p class="product-info" id='confirmName'></p>
        <p class="product-info" id='confirmLastName'></p>
        <p class="product-info" id='confirmEmail'></p>
        <hr>
        <p class="product-info" id='confirmProduct'></p>
        <p class="product-info" id='confirmPrice'></p>
      </div>
      <hr>
      <p style="color: #3098de; font-size: 13px;text-align: center">Review all information</p>
    </div>

    <div class="user-modal-footer">
      <button class="crayons-btn crayons-btn--secondary continue-btn-payment" id="confirmPaymentBtn">Confirm Order</button>
    </div>
  </div>

</div>

<!-- The Modal -->
<div id="paymentConfirmationModal" class="user-modal">

  <!-- Modal content -->
  <div class="user-modal-content">
    <!--    <div class="user-modal-header">-->
    <!--      <span class="user-close">&times;</span>-->
    <!--      Add your information-->
    <!--    </div>-->
    <header class="Header" role="banner">
      <div>
        <span>
        </span>
        <span class="Header-navClose" aria-label="Close">

        </span>
      </div>
      <div class="Header-logo">
        <div class="Header-logoWrap">
          <div class="Header-logoBevel">
          </div>
          <div class="Header-logoBorder">
          </div>
          <div class="Header-logoImage" alt="Logo">
          </div>
        </div>
      </div>
      <h2 class="Header-purchaseDescription u-textTruncate">
        Review Order Details
      </h2>
      <div class="Header-account" style="position: relative;">
      </div>
    </header>
    <div class="user-modal-body">
      <h1>Project</h1>
      <p>Test project</p>
      <h1>Price</h1>
      <p>12.00 $</p>
      <%#= form_tag stripe_active_cards_path, id: "credit-card-form", method: :post do %>
<!--        <div class="crayons-field mb-3">-->
<!--                    <label class="crayons-field__label" for="user_email">First Name</label>-->
<!--          <input autocomplete="first_name" class="crayons-textfield" type="text" name="first_name" placeholder="First name" id="first_name" required>-->
<!--          <p style="display: none" id="first_name_error" class="error-text">First name can't be blank</p>-->
<!--        </div>-->
<!--        <div class="crayons-field mb-3">-->
<!--                   <label class="crayons-field__label" for="user_email">Last Name</label>-->
<!--          <input autocomplete="last_name" class="crayons-textfield" type="text" name="last_name" placeholder="Last name" id="last_name" required>-->
<!--          <p style="display: none" id="last_name_error" class="error-text">Last name can't be blank</p>-->
<!--        </div>-->
<!--        <div class="crayons-field mb-3">-->
<!--                   <label class="crayons-field__label" for="user_email">Email</label>-->
<!--          <input autocomplete="email" class="crayons-textfield" type="email" name="email" placeholder="Email" id="email" required>-->
<!--          <p style="display: none" class="error-text" id="email_error">Email is invalid</p>-->
<!--        </div>-->
<!--        <input type="hidden" name="stripe_token" id="stripe_card_token">-->

<!--        <button class="crayons-btn crayons-btn--secondary" id="continue">Continue</button>-->
      <%# end %>
    </div>
    <!--    <div class="user-modal-footer">-->
    <!--      <button class="crayons-btn crayons-btn--secondary" id="continue">Continue</button>-->
    <!--    </div>-->
  </div>

</div>
<!-- New View Html -->
<div id="hero-html-wrapper" class="codeland-banner-container" style="display: none">
  <section class="crayons-layout">
    <div class="container-fluid" style="position: relative; top: 20px">
      <div class="row top-banner">
        Join now, the private testing mode, and be one of the first to access the future of music streaming
      </div>
    </div>
    <div class="codeland-banner banner-pd-90 h-auto">
      <div class="row">
        <p class="new-white-text-banner" style="display: none">
          STREAMING EXCLUSIVELY ON
        </p>
        <p class="juke-text-banner-description">new music releases.</p>
        <p class="juke-text-banner-description">raw n uncut studio recordings</p>
        <br>
        <img class="juke-img-banner" src="https://studioappbucket.s3.ap-south-1.amazonaws.com/uploads/KKL.png" alt="logo">
      </div>
      <p class="juke-text-banner pb-20">
        JUKEBOX
      </p>
    </div>
  </section>
</div>

<div class="crayons-layout crayons-layout--3-cols crayons-layout--3-cols--drop-right-left">
  <%= render "articles/sidebar" %>
  <main class="articles-list crayons-layout__content" id="articles-list">
    <!-- Header -->
    <header class="flex items-center p-2 m:p-0 m:pb-2" id="on-page-nav-controls">
<!--      <button type="button" class="crayons-btn crayons-btn--ghost crayons-btn--icon mr-2 inline-block m:hidden" id="on-page-nav-butt-left" aria-label="nav-button-left">-->
<!--        <div class="crayons-icon nav-icon ">-->
<!--          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" height="24" width="24"><path d="M398.044 29.719C359.712 10.555 309.267 0 256.001 0c-53.271 0-103.719 10.555-142.05 29.721-43.457 21.73-67.39 52.497-67.39 86.635v279.288c0 34.138 23.933 64.906 67.392 86.636C152.285 501.446 202.732 512 256.002 512c53.266 0 103.711-10.555 142.043-29.721 43.46-21.732 67.393-52.498 67.393-86.636V116.355c.001-34.138-23.934-64.904-67.394-86.636zM256.001 46.548c93.229 0 162.889 36.855 162.889 69.808 0 32.953-69.66 69.809-162.889 69.809-93.23 0-162.892-36.857-162.892-69.809 0-32.953 69.661-69.808 162.892-69.808zm162.89 349.095c0 32.953-69.662 69.809-162.891 69.809-93.23 0-162.892-36.856-162.892-69.809v-18.58c6.348 4.292 13.294 8.346 20.844 12.121 38.332 19.167 88.779 29.721 142.05 29.721 53.266 0 103.711-10.555 142.043-29.721 7.552-3.777 14.498-7.829 20.846-12.121v18.58zm.002-93.095h-.002c0 32.953-69.66 69.809-162.889 69.809-93.23 0-162.892-36.857-162.892-69.809v-18.58c6.348 4.292 13.294 8.343 20.844 12.119 38.332 19.168 88.779 29.722 142.05 29.722 53.266 0 103.711-10.555 142.043-29.722 7.552-3.777 14.498-7.829 20.846-12.123v18.584zm0-93.097h-.002c0 32.954-69.66 69.811-162.889 69.811-93.23 0-162.892-36.856-162.892-69.811v-18.579c6.348 4.292 13.294 8.343 20.844 12.118 38.331 19.167 88.779 29.721 142.05 29.721 53.266 0 103.711-10.555 142.043-29.721 7.552-3.777 14.498-7.829 20.846-12.121v18.582z"></path></svg>-->
<!--          <svg width="26" height="26" viewBox="0 0 43 31" fill="none" xmlns="http://www.w3.org/2000/svg">-->
<!--            <line y1="0.5" x2="43" y2="0.5" stroke="black"/>-->
<!--            <line y1="30.5" x2="43" y2="30.5" stroke="black"/>-->
<!--            <line y1="13.5" x2="43" y2="13.5" stroke="black"/>-->
<!--          </svg>-->

<!--        </div>-->
<!--      </button>-->
      <button type="button" class="crayons-btn crayons-btn--ghost crayons-btn--icon mr-2 inline-block m:hidden" id="on-page-nav-butt-left" aria-label="nav-button-left">
        <div class="crayons-icon nav-icon ">
          <%#= SiteConfig.left_navbar_svg_icon.html_safe %>
          <%= inline_svg_tag("hamburger.svg", aria: true, class: "crayons-icon", title: "Navigation menu") %>
        </div>
      </button>
      <div class="flex-1 flex items-center justify-between">
        <h2 class="crayons-subtitle-2 n-releases">Streaming</h2>
        <nav class="crayons-tabs hidden s:flex">
          <a href="/latest" class="crayons-tabs__item">Communities</a>
          <a href="/projects_feed" class="crayons-tabs__item crayons-tabs__item--current">Streaming</a>
        </nav>
<!--        <select class="crayons-select s:hidden ml-2 s:ml-auto w-auto" id="feed-filter-select" aria-label="feed-filter-select">-->
<!--          <option value="/latest">Posts</option>-->
<!--          <option value="/projects_feed" selected>New releases</option>-->
<!--        </select>-->
        <nav class="crayons-tabs s:hidden ml-2 s:ml-auto w-auto w-100" id="feed-filter-select" aria-label="feed-filter-select">
          <a href="/projects_feed" class="crayons-tabs__item crayons-tabs__item--current">Streaming</a>
          <a href="/latest" class="crayons-tabs__item">Communities</a>
        </nav>
      </div>

<!--      <button type="button" class="crayons-btn crayons-btn--ghost crayons-btn--icon ml-2 inline-block l:hidden" id="on-page-nav-butt-right" aria-label="nav-button-right">-->
<!--        <div class="crayons-icon nav-icon ">-->
<!--          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 216.934 216.934" height="24" width="24"><path d="M179.508 91.769a7.5 7.5 0 00-6.95-4.681h-32.323l26.743-77.131a7.5 7.5 0 00-12.373-7.777L39.089 116.98a7.499 7.499 0 005.288 12.82h32L47.26 206.781a7.499 7.499 0 0012.238 8.034L177.782 99.969a7.5 7.5 0 001.726-8.2zM73.196 180.61l21.051-55.657a7.5 7.5 0 00-7.015-10.153H62.563l79.623-79.13-19.575 56.462a7.5 7.5 0 007.085 9.957h24.37l-80.87 78.521z"></path></svg>-->
<!--        </div>-->
<!--      </button>-->
    </header>
    <!-- Center Content Div -->
    <div style="min-height: 90vh">
      <div class="container-fluid">
        <div class="row top-banner m-banner">
          <!--    Join now, the private testing mode, and be one of the first to access the future of music streaming-->
          Jukebox is a web music platform to allow indie artists monetise streaming. We are in testing mode. Join now and help us build the future of music
        </div>
      </div>
      <% @organizations.each do |project| %>
        <% if project.music_releases.first.present? %>
          <%= render partial: 'shared/project_card_latest', locals: {project: project, music_release: project.music_releases.first, composer: project.composer_id.present? ? @composers[project.composer_id][0] : '', artist_side: false, project_side: false } %>
        <% end %>
      <% end %>
      <!-- Right sidebar -->
      <div class="sidebar-wrapper sidebar-wrapper-right crayons-layout__sidebar-right">
      </div>
    </div>
  </main>
</div>
<script src="https://checkout.stripe.com/checkout.js"></script>
<script type="text/javascript" charset="utf-8">
  // var span = document.getElementsByClassName("user-close")[0];
  var mainNavMoreTrigger = document.getElementById('main-nav-more-trigger');
  function toggleMainNavMore() {
    document.getElementById('main-nav-more').classList.remove('hidden');
    mainNavMoreTrigger.classList.add('hidden');
  }
  if (mainNavMoreTrigger) {
    mainNavMoreTrigger.addEventListener('click', toggleMainNavMore);
  }
  // When the user clicks the button, open the modal
  function openModal(){
    <% unless current_user.present? %>
      resetFields();
    <% end %>
    var modal = document.getElementById("myModal");
    modal.style.display = "block";
  }

  // function openConfirmationModal(){
  //   var modal = document.getElementById("paymentConfirmationModal");
  //   modal.style.display = "block";
  // }
  // When the user clicks on <span> (x), close the modal
  function closeModal(){
    var modal = document.getElementById("myModal");
    modal.style.display = "none";
  }

  function closeCardModal(){
    var modal = document.getElementById("myCardModal");
    modal.style.display = "none";
  }
  // span.onclick = function() {
  //   var modal = document.getElementById("myModal");
  //   resetFields();
  //   modal.style.display = "none";
  // }

  // When the user clicks anywhere outside of the modal, close it
  window.onclick = function(event) {
    var modal = document.getElementById("myModal");
    var cmodal = document.getElementById("confirmationModal");
    var ccmodal = document.getElementById("myCardModal");
    if (event.target == modal) {
      <% unless current_user.present? %>
        resetFields();
      <% end %>
      modal.style.display = "none";
    }
    if (event.target == ccmodal) {
      ccmodal.style.display = "none";
    }
  }
  function resetFields(){
    document.getElementById('first_name').value = '';
    document.getElementById('last_name').value = '';
    document.getElementById('email').value = '';
    document.getElementById('password').value = '';
    document.getElementById('first_name_error').style.display='none'
    document.getElementById('last_name_error').style.display='none'
    document.getElementById('email_error').style.display='none'
    document.getElementById('password_error').style.display='none'
  }
  function buy_product(music_release_id, price, name){
    document.getElementById('product-name').innerText=name;
    document.getElementById('product-price').innerHTML='$ '+ price.toFixed(2);
    document.getElementById('music_release_id').value=music_release_id;
    document.getElementById('project_price').value=price.toFixed(2);
    // $('#product-price').value=price;
    openModal();
    // handler.open({
    //   description: 'Add Credit Card',
    //   amount: 0,
      //email: "<%#= current_user.present? ? current_user.email : '' %>",
      // address: "asadadadasdadadddad",
      // street: false,
      // city: false,
      // panelLabel: "Add Card",
    // });
  }
  setTimeout(function () {
    var handler = StripeCheckout.configure({
      key: '<%= SiteConfig.stripe_publishable_key %>',
      image: "https://res.cloudinary.com/dyzicyjzq/image/fetch/s--rMcf2ecU--/c_fill,f_auto,fl_progressive,h_90,q_auto,w_90/https://studioappbucket.s3.amazonaws.com/uploads/user/profile_image/6/bad08ef2-a74c-4316-8084-a645c5052bef.png",
      locale: 'auto',
      token: function (token) {
        var token_input = document.getElementById("stripe_card_token")
        token_input.value = token.id
        document.getElementById('continue-payment-btn').click();
        // var form = document.getElementById('credit-card-form')
        // form.submit();
        // openConfirmationModal();
        // document.getElementById('add-credit-card-button').style.display = 'none'
        // document.getElementById('card-msg').style.display = 'block'

      }

    });
    <%# if current_user.try(:stripe_id_code).blank? %>
<!--    document.getElementById('buy-music-btn-<%#= project.id %>').addEventListener('click', function (e) {-->
      // Open Checkout with further options:

      // e.preventDefault();
    // });
    <%# end %>
    function openConfirmationModal(){
      var first_name = document.getElementById('first_name').value;
      var last_name = document.getElementById('last_name').value;
      var email = document.getElementById('email').value;
      document.getElementById('confirmName').innerHTML = first_name;
      document.getElementById('confirmLastName').innerHTML = last_name;
      document.getElementById('confirmEmail').innerHTML = email;
      document.getElementById('confirmProduct').innerHTML = document.getElementById('product-name').innerHTML
      document.getElementById('confirmPrice').innerHTML = document.getElementById('product-price').innerHTML
      var modal = document.getElementById("confirmationModal");
      modal.style.display = "block";
    }

    document.getElementById('confirmPaymentBtn').addEventListener('click', function (e){
      document.getElementById('confirmPaymentBtn').innerText = 'Please wait'
      document.getElementById('confirmPaymentBtn').disabled = true
      var form = document.getElementById('credit-card-form')
      form.submit();
    })

    document.getElementById('continue-payment-btn').addEventListener('click', function (e){
      closeCardModal();
      openConfirmationModal();
    })
    document.getElementById('continue').addEventListener('click', function (e){
      var first_name = document.getElementById('first_name').value;
      var last_name = document.getElementById('last_name').value;
      var email = document.getElementById('email').value;
      var password = document.getElementById('password').value;
      var error_count = 0;
      if (first_name.replace(/\s/g, '') == ''){
        document.getElementById('first_name_error').style.display='block'
        error_count = error_count + 1;
      }else{
        document.getElementById('first_name_error').style.display='none'
      }
      if (last_name.replace(/\s/g, '') == ''){
        document.getElementById('last_name_error').style.display='block'
        error_count = error_count + 1;
      }else{
        document.getElementById('last_name_error').style.display='none'
      }
      if (email.replace(/\s/g, '') == '' || !email.includes('@')){
        document.getElementById('email_error').style.display='block'
        error_count = error_count + 1;
      }else{
        document.getElementById('email_error').style.display='none'
      }
      if (password.replace(/\s/g, '') == '' || password.length < 8){
        document.getElementById('password_error').style.display='block'
        error_count = error_count + 1;
      }else{
        document.getElementById('password_error').style.display='none'
      }
      if(error_count == 0){
        closeModal();
        <% unless @source.present? %>
          handler.open({
            description: 'Add Credit Card',
            amount: 0,
            email: document.getElementById('email').value,
            panelLabel: "Add Card",
            // panelLabel: "Confirm purchase",
          });
        <% else %>
          var modal = document.getElementById("myCardModal");
          modal.style.display = "block";
        <% end %>
      }
      e.preventDefault();
    })
    // Close Checkout on page navigation:
    window.addEventListener('popstate', function () {
      handler.close();
    });
  }, 220)
</script>
